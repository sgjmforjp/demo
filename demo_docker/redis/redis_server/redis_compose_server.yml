# yaml 配置实例
version: '3.9'

services: 
  redis_server_1:
    image: redis:latest
    container_name: redis_server_1
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "16000:6379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-server /opt/redis/server/config/redis-server.conf --requirepass 1234 --masterauth 1234"
    volumes:
      - ./server_1/data:/opt/redis/data
      - ./server_1/logs:/opt/redis/logs
      - ./config/server_1:/opt/redis/server/config

  redis_server_2:
    image: redis:latest
    container_name: redis_server_2
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "16001:6379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-server /opt/redis/server/config/redis-server.conf --slaveof redis_server_1 6379 --requirepass 1234 --masterauth 1234"
    volumes:
      - ./server_2/data:/opt/redis/data
      - ./server_2/logs:/opt/redis/logs
      - ./config/server_2:/opt/redis/server/config
    depends_on:
      - redis_server_1

  redis_server_3:
    image: redis:latest
    container_name: redis_server_3
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "16002:6379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-server /opt/redis/server/config/redis-server.conf --slaveof redis_server_1 6379 --requirepass 1234 --masterauth 1234"
    volumes:
      - ./server_3/data:/opt/redis/data
      - ./server_3/logs:/opt/redis/logs
      - ./config/server_3:/opt/redis/server/config
    depends_on:
      - redis_server_1

  redis_sentinel_1:
    image: redis:latest
    container_name: redis_sentinel_1
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "27001:26379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-sentinel /opt/redis/sentinel/config/redis-sentinel.conf"
    volumes:
      - ./sentinel_1/data:/opt/redis/data
      - ./sentinel_1/logs:/opt/redis/logs
      - ./config/sentinel_1:/opt/redis/sentinel/config
    depends_on:
      - redis_server_1
      - redis_server_2
      - redis_server_3

  redis_sentinel_2:
    image: redis:latest
    container_name: redis_sentinel_2
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "27002:26379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-sentinel /opt/redis/sentinel/config/redis-sentinel.conf"
    volumes:
      - ./sentinel_2/data:/opt/redis/data
      - ./sentinel_2/logs:/opt/redis/logs
      - ./config/sentinel_2:/opt/redis/sentinel/config
    depends_on:
      - redis_server_1
      - redis_server_2
      - redis_server_3

  redis_sentinel_3:
    image: redis:latest
    container_name: redis_sentinel_3
    restart: always
    privileged: true
    environment:
      TZ: "Asia/Shanghai"
      LANG: "en_US.UTF-8"
    ports: 
      - "27003:26379"
    env_file: 
      - ./config/redis.env
    command: /bin/bash -c "redis-sentinel /opt/redis/sentinel/config/redis-sentinel.conf"
    volumes:
      - ./sentinel_3/data:/opt/redis/data
      - ./sentinel_3/logs:/opt/redis/logs
      - ./config/sentinel_3:/opt/redis/sentinel/config
    depends_on:
      - redis_server_1
      - redis_server_2
      - redis_server_3

